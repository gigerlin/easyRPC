// Generated by CoffeeScript 1.10.0

/*
  @author Gilles Gerlinger
  Copyright 2015. All rights reserved.
 */

(function() {
  var Promise, Response, fetch;

  if (typeof window === 'object') {
    Promise = window.Promise || require('./promise');
  }

  Response = (function() {
    function Response(data, ok) {
      this.data = data;
      this.ok = ok != null ? ok : true;
    }

    Response.prototype.json = function() {
      return JSON.parse(this.data);
    };

    return Response;

  })();

  module.exports = fetch = function(uri, options) {
    return new Promise(function(resolve, reject) {
      var xhr;
      xhr = new XMLHttpRequest();
      xhr.open(options.method, uri, true);
      xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
      xhr.send(options.body || null);
      xhr.onload = function() {
        if (xhr.response.indexOf('"') === -1) {
          return reject(xhr.response);
        } else {
          return resolve(new Response(xhr.response));
        }
      };
      return xhr.onerror = function() {
        return reject("xhr error: " + xhr.statusText);
      };
    });
  };

}).call(this);
